# ğŸ’­ 2026-02-09 (Mon) TIL

## ğŸŒ± Todo


- âœ”ï¸ ~~ìƒˆì‹¹(SeSAC) ê°•ì˜ ì§„ë„ ë”°ë¼ê°€ê¸°~~
  - 1:N
  - N:M

...

## ğŸ§ ê°„ë‹¨ ì •ë¦¬

## FastAPI
### 1. ê´€ê³„ ì„¤ì • (1:N & N:M)

#### 1-1. 1:N (ì¼ëŒ€ë‹¤) ê´€ê³„

ë¶€ëª¨(Category)ê°€ ì—¬ëŸ¬ ìì‹(Product)ì„ ê°€ì§ˆ ë•Œ ì‚¬ìš©í•˜ëŠ” ê¸°ë³¸ êµ¬ì¡°ì…ë‹ˆë‹¤.

* **ë¶€ëª¨:** `Mapped[list["Child"]]` (ì—¬ëŸ¬ ëª…ì„ ê´€ë¦¬í•˜ë‹ˆê¹Œ ë¦¬ìŠ¤íŠ¸)
* **ìì‹:** `Mapped["Parent"]` (ë‚´ê°€ ì†í•œ ë¶€ëª¨ëŠ” í•˜ë‚˜ë‹ˆê¹Œ ë‹¨ìˆ˜) + `ForeignKey`

```python
# ë¶€ëª¨ ëª¨ë¸ (Category)
products: Mapped[list["Product"]] = relationship(back_populates="category")

# ìì‹ ëª¨ë¸ (Product)
category_id: Mapped[int] = mapped_column(ForeignKey("category.id"))
category: Mapped["Category"] = relationship(back_populates="products")

```

#### 1-2. N:M (ë‹¤ëŒ€ë‹¤) ê´€ê³„ - ì¤‘ê°„ ëª¨ë¸ ë°©ì‹

ê²Œì‹œê¸€(Post)ê³¼ íƒœê·¸(Tag)ì²˜ëŸ¼ ì„œë¡œê°€ ì„œë¡œë¥¼ ë§ì´ ê°€ì§ˆ ìˆ˜ ìˆëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤. ì¤‘ê°„ í…Œì´ë¸”ì— ì¶”ê°€ ë°ì´í„°(ë“±ë¡ì¼ ë“±)ë¥¼ ì €ì¥í•  ìˆ˜ ìˆì–´ ì‹¤ë¬´ì—ì„œ ê°€ì¥ ê¶Œì¥ë©ë‹ˆë‹¤.

```python
# ì¤‘ê°„ ëª¨ë¸ (PostTag)
class PostTag(Base):
    __tablename__ = "post_tags"
    post_id: Mapped[int] = mapped_column(ForeignKey("posts.id"), primary_key=True)
    tag_id: Mapped[int] = mapped_column(ForeignKey("tags.id"), primary_key=True)
    created_at: Mapped[datetime] = mapped_column(server_default=func.now()) # ì¶”ê°€ ë°ì´í„°

    post: Mapped["Post"] = relationship(back_populates="post_tags")
    tag: Mapped["Tag"] = relationship(back_populates="post_tags")

# Post ëª¨ë¸
post_tags: Mapped[list["PostTag"]] = relationship(back_populates="post")
# AssociationProxyë¥¼ ì“°ë©´ post.tagsë¡œ íƒœê·¸ ê°ì²´ì— ì§ì ‘ ì ‘ê·¼ ê°€ëŠ¥
tags: AssociationProxy[list["Tag"]] = association_proxy("post_tags", "tag")

```

---

### 2. ì£¼ìš” ì—ëŸ¬ ë° í•´ê²° ë°©ë²• (Troubleshooting)

| ì—ëŸ¬ ë©”ì‹œì§€ | ë°œìƒ ì›ì¸ | í•´ê²° ë°©ë²• |
| --- | --- | --- |
| **TypeError: ... got 'autocrement'** | `autoincrement` í‚¤ì›Œë“œ ì˜¤íƒ€ | ì² ì í™•ì¸ (`in` ì¶”ê°€) |
| **NoReferencedTableError** | `ForeignKey`ì— ì ì€ í…Œì´ë¸”ëª…ì´ ì‹¤ì œì™€ ë‹¤ë¦„ | `__tablename__`ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸ |
| **InvalidRequestError: No property...** | `back_populates`ì˜ ì´ë¦„ì´ ìƒëŒ€ë°© ë³€ìˆ˜ëª…ê³¼ ë‹¤ë¦„ | ì–‘ìª½ ëª¨ë¸ì˜ ë³€ìˆ˜ëª…ê³¼ ë¬¸ìì—´ì„ "ê±°ìš¸"ì²˜ëŸ¼ ì¼ì¹˜ì‹œí‚´ |
| **ForeignKeyViolation (IntegrityError)** | ì°¸ì¡°í•˜ë ¤ëŠ” ë¶€ëª¨ ë°ì´í„°(ID)ê°€ DBì— ì—†ìŒ | ë¶€ëª¨ ë°ì´í„°ë¥¼ ë¨¼ì € ìƒì„±(Commit) í›„ ìì‹ ìƒì„± |
| **AttributeError: module ... has no attr** | ëª¨ë“ˆ(íŒŒì¼)ê³¼ í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ í˜¸ì¶œ í˜¼ë™ | `from ... import ê°ì²´ëª…`ìœ¼ë¡œ ì •í™•íˆ ì„í¬íŠ¸ |
| **Postman 404 Error** | URL ì˜¤íƒ€ ë° ì£¼ì†Œ ì¤‘ì²© | postman ì¬ì‹œì‘|

---

### 3. í•µì‹¬ í¬ì¸íŠ¸ ìš”ì•½

1. **Relationshipì€ ê±°ìš¸ì´ë‹¤**: í•œìª½ì˜ `back_populates`ëŠ” ë°˜ë“œì‹œ ë°˜ëŒ€ìª½ì˜ **ë³€ìˆ˜ ì´ë¦„**ì„ ê°€ë¦¬ì¼œì•¼ í•œë‹¤.
2. **Import ìˆœì„œ**: `Base.metadata.create_all()` í˜¸ì¶œ ì „, ê´€ê³„ëœ ëª¨ë“  ëª¨ë¸ íŒŒì¼ì´ `import` ë˜ì–´ì•¼ í…Œì´ë¸”ì´ ì •ìƒ ìƒì„±ëœë‹¤.
3. **ë°ì´í„° ë¬´ê²°ì„±**: ìì‹ì„ ë§Œë“¤ ë•ŒëŠ” í•­ìƒ ë¶€ëª¨ê°€ ì‹¤ì¡´í•˜ëŠ”ì§€ ë¨¼ì € ê²€ì¦í•´ì•¼ í•œë‹¤.
4. **ë¡œê·¸ê°€ ì •ë‹µì´ë‹¤**: 404ë‚˜ 500 ì—ëŸ¬ê°€ ë‚  ë•ŒëŠ” í„°ë¯¸ë„ ë¡œê·¸ì— ì°íŒ **ì‹¤ì œ ìš”ì²­ ì£¼ì†Œ**ì™€ **DB ìƒì„¸ ì—ëŸ¬**ë¥¼ ë¨¼ì € ì½ì.

---
...

## ğŸš íšŒê³ 
**fastAPIëŠ” ì²˜ìŒ ë°°ì›Œë³´ëŠ”ë° ì¥ê³ ë‘ ë¹„ìŠ·í•˜ë©´ì„œ ë‹¤ë¥´ë‹¤**